<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
      {% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{%
      else %}{{ site.title | escape }}{% endif %}
    </title>
    <meta
      name="description"
      content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}"
    />
    <meta name="author" content="{{ site.author | escape }}" />
    <meta
      name="keywords"
      content="{{ page.keywords | default: site.keywords | escape }}"
    />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ page.url | absolute_url }}" />
    <meta
      property="og:title"
      content="{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}"
    />
    <meta
      property="og:description"
      content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}"
    />
    <meta
      property="og:image"
      content="{{ '/assets/img/foto_profilo.jpg' | absolute_url }}"
    />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="{{ page.url | absolute_url }}" />
    <meta
      property="twitter:title"
      content="{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}"
    />
    <meta
      property="twitter:description"
      content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}"
    />
    <meta
      property="twitter:image"
      content="{{ '/assets/img/foto_profilo.jpg' | absolute_url }}"
    />

    <!-- Canonical link -->
    <link
      rel="canonical"
      href="{{ page.url | replace:'index.html','' | absolute_url }}"
    />

    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}" />
    <link
      rel="shortcut icon"
      href="{{ '/assets/img/favicon.ico' | relative_url }}"
      type="image/x-icon"
    />
    <link
      rel="icon"
      href="{{ '/assets/img/favicon.ico' | relative_url }}"
      type="image/x-icon"
    />
    {% seo %}
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="site-title" href="{{ '/' | relative_url }}"
          >{{ site.title | escape }}</a
        >
        <div class="nav-right">
          <!-- Toggle tema spostato fuori dal menu hamburger -->
          <button
            id="theme-toggle"
            class="theme-toggle"
            aria-label="Toggle dark mode"
          >
            <svg
              class="sun-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg
              class="moon-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>

          <nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
              <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                  <path
                    d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,1.484,0,0.82,0,0c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,0,18,0.665,18,1.484z"
                  />
                  <path
                    d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516z"
                  />
                  <path
                    d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516z"
                  />
                </svg>
              </span>
            </label>

            <div class="trigger">
              <a class="page-link" href="{{ '/' | relative_url }}">Home</a>
              <div class="dropdown">
                <a class="page-link dropdown-toggle">Research</a>
                <div class="dropdown-content">
                  <a href="{{ '/working-papers' | relative_url }}"
                    >Working Papers</a
                  >
                  <a href="{{ '/publications' | relative_url }}"
                    >Publications</a
                  >
                </div>
              </div>
              <a class="page-link" href="{{ '/teaching' | relative_url }}"
                >Teaching</a
              >
              <a class="page-link" href="{{ '/conferences' | relative_url }}"
                >Conferences</a
              >
              <a class="page-link" href="{{ '/cv' | relative_url }}">CV</a>
            </div>
          </nav>
        </div>
      </div>
    </header>

    <main class="page-content">
      <div class="container">{{ content }}</div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <div class="footer-col-wrapper">
          <div class="footer-col">
            <h2 class="footer-heading">{{ site.title | escape }}</h2>
            <p>{{ site.position }} presso {{ site.institution }}</p>
          </div>
          <div class="footer-col">
            <h2>Contatti</h2>
            <ul class="contact-list">
              <li><a href="mailto:{{ site.email }}">{{ site.email }}</a></li>
              {% if site.phone %}
              <li>{{ site.phone }}</li>
              {% endif %} {% if site.office %}
              <li>{{ site.office }}</li>
              {% endif %}
            </ul>
          </div>
          <div class="footer-col">
            <h2>Collegamenti</h2>
            <ul class="social-media-list">
              {% if site.social_links.github %}
              <li>
                <a
                  href="https://github.com/{{ site.social_links.github }}"
                  target="_blank"
                  >GitHub</a
                >
              </li>
              {% endif %} {% if site.social_links.linkedin %}
              <li>
                <a
                  href="https://www.linkedin.com/in/{{ site.social_links.linkedin }}"
                  target="_blank"
                  >LinkedIn</a
                >
              </li>
              {% endif %} {% if site.social_links.twitter %}
              <li>
                <a
                  href="https://twitter.com/{{ site.social_links.twitter }}"
                  target="_blank"
                  >Twitter</a
                >
              </li>
              {% endif %} {% if site.social_links.scholar %}
              <li>
                <a
                  href="https://scholar.google.com/citations?user={{ site.social_links.scholar }}"
                  target="_blank"
                  >Google Scholar</a
                >
              </li>
              {% endif %} {% if site.social_links.orcid %}
              <li>
                <a
                  href="https://orcid.org/{{ site.social_links.orcid }}"
                  target="_blank"
                  >ORCID</a
                >
              </li>
              {% endif %}
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>
            &copy; {{ site.time | date: '%Y' }} {{ site.title | escape }}. Tutti
            i diritti riservati.
          </p>
        </div>
      </div>
    </footer>

    <script>
      // Theme toggle functionality
      document.addEventListener("DOMContentLoaded", function () {
        const themeToggle = document.getElementById("theme-toggle");
        const prefersDarkScheme = window.matchMedia(
          "(prefers-color-scheme: light)"
        );

        // Check for saved theme preference or use the system preference
        const currentTheme =
          localStorage.getItem("theme") ||
          (prefersDarkScheme.matches ? "dark" : "light");

        // Apply the current theme
        document.documentElement.setAttribute("data-theme", currentTheme);

        // Update toggle button state
        updateToggleState(currentTheme);

        // Toggle theme when button is clicked
        themeToggle.addEventListener("click", function () {
          let theme = document.documentElement.getAttribute("data-theme");
          let newTheme = theme === "light" ? "dark" : "light";

          document.documentElement.setAttribute("data-theme", newTheme);
          localStorage.setItem("theme", newTheme);

          updateToggleState(newTheme);
        });

        // Update toggle button appearance based on current theme
        function updateToggleState(theme) {
          if (theme === "dark") {
            document.querySelector(".sun-icon").style.display = "inline-block";
            document.querySelector(".moon-icon").style.display = "none";
          } else {
            document.querySelector(".sun-icon").style.display = "none";
            document.querySelector(".moon-icon").style.display = "inline-block";
          }
        }

        // Listen for system theme changes
        prefersDarkScheme.addEventListener("change", function (e) {
          if (!localStorage.getItem("theme")) {
            const newTheme = e.matches ? "dark" : "light";
            document.documentElement.setAttribute("data-theme", newTheme);
            updateToggleState(newTheme);
          }
        });

        // Gestione dropdown mobile
        const dropdowns = document.querySelectorAll(".dropdown");

        dropdowns.forEach((dropdown) => {
          const toggle = dropdown.querySelector(".dropdown-toggle");

          toggle.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();

            // Chiude tutti gli altri dropdown
            dropdowns.forEach((d) => {
              if (d !== dropdown && d.classList.contains("active")) {
                d.classList.remove("active");
              }
            });

            // Toggle stato active - permette di chiudere cliccando nuovamente
            dropdown.classList.toggle("active");
          });
        });

        // Chiudi dropdown quando si clicca fuori
        document.addEventListener("click", function (e) {
          if (!e.target.closest(".dropdown")) {
            dropdowns.forEach((d) => {
              d.classList.remove("active");
            });
          }
        });
      });
    </script>
  </body>
</html>
